<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>채팅 사이트</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { font-family: sans-serif; background:#f4f4f4; padding:20px; }
    #usersPanel { position: fixed; top: 10px; right: 10px; width: 200px; background: white; border: 1px solid #ccc; padding: 10px; display: none; }
    #usersPanel h3 { margin-top:0; }
    #usersPanel button { margin-left: 5px; font-size: 12px; }
  </style>
</head>
<body>
  <h2>닉네임 설정</h2>
  <input id="nickname" placeholder="닉네임 입력">
  <button id="setNickBtn">확인</button>

  <div id="roomArea" style="margin-top:20px;">
    <h3>채팅방 목록</h3>
    <ul id="roomList"></ul>
  </div>

  <div id="usersPanel">
    <h3>접속자 목록</h3>
    <ul id="userList"></ul>
  </div>

  <script>
    const socket = io();
    let myNick = "";
    let isAdmin = false;

    document.getElementById('setNickBtn').onclick = () => {
      const nickname = document.getElementById('nickname').value.trim();
      if (!nickname) return alert("닉네임을 입력하세요!");

      let password = "";
      if (nickname === "크로바츠입니다") {
        password = prompt("관리자 비밀번호를 입력하세요:");
      }
      myNick = nickname;
      socket.emit('setNickname', { nickname, password });
    };

    socket.on('loginFailed', msg => alert(msg));
    socket.on('adminLogin', () => {
      isAdmin = true;
      document.getElementById('usersPanel').style.display = "block";
      alert("관리자 모드로 로그인되었습니다.");
    });

    socket.on('userList', list => {
      const ul = document.getElementById('userList');
      ul.innerHTML = "";
      list.forEach(nick => {
        const li = document.createElement('li');
        li.textContent = nick;
        if (isAdmin && nick !== "크로바츠입니다") {
          const warnBtn = document.createElement('button');
          warnBtn.textContent = "⚠경고";
          warnBtn.onclick = () => socket.emit('warnUser', { target: nick });
          const banBtn = document.createElement('button');
          banBtn.textContent = "⛔밴";
          banBtn.onclick = () => socket.emit('banUser', { target: nick });
          li.appendChild(warnBtn);
          li.appendChild(banBtn);
        }
        ul.appendChild(li);
      });
    });

    socket.on('warned', () => {
      alert("개발자한테 뭐하는지 걸렸어요 ㅋㅋ 1번만 더 그짓거리하면 밴됩니다.");
    });

    socket.on('banned', msg => {
      alert(msg);
      location.reload();
    });
  </script>
</body>
</html>
