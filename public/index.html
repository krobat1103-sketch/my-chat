
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Modern Chat</title>
<link rel="stylesheet" href="style.css">
<script src="/socket.io/socket.io.js"></script>
</head>
<body>
<div class="leftPanel">
  <h2>닉네임</h2>
  <input id="nickname" placeholder="닉네임">
  <button id="saveNick">저장</button>

  <h2>방 목록</h2>
  <input id="search"><button id="btnSearch">검색</button>
  <ul id="roomList"></ul>

  <h2>방 만들기</h2>
  <input id="newRoomName" placeholder="방 이름">
  <label><input type="checkbox" id="usePassword"> 비번</label>
  <input id="roomPassword" placeholder="비밀번호">
  <button id="createRoom">생성</button>
</div>

<div class="rightPanel">
  <div id="adminPanel" class="adminPanel" style="display:none;">
    <h3>관리자 패널</h3>
    <div id="banList"></div>
  </div>

  <div id="chat" style="display:none;">
    <h3 id="roomTitle"></h3>
    <div id="messages" class="messages"></div>
    <input id="msgInput" placeholder="메시지">
    <button id="sendBtn">전송</button>
  </div>
</div>

<script>
const socket = io();
const ADMIN_NAME = "크로바츠입니다";

function getNick(){
  let n = document.getElementById("nickname").value;
  return n;
}

document.getElementById("saveNick").onclick = ()=>{
  localStorage.setItem("nickname", getNick());
  alert("저장됨");
};

socket.on("roomList",(rooms)=>{
  const ul = document.getElementById("roomList");
  ul.innerHTML = "";
  rooms.forEach(r=>{
    const li = document.createElement("li");
    li.innerHTML = r.name + " <button onclick="joinR('" + r.id + "')">입장</button>";
    ul.appendChild(li);
  });
});

function joinR(id){
  const nick = getNick();
  const pw = prompt("비밀번호:");
  socket.emit("joinRoom",{roomId:id,nickname:nick,password:pw});
}

socket.on("joinSuccess",(id)=>{
  document.getElementById("chat").style.display = "block";
  document.getElementById("roomTitle").textContent = "방: " + id;
});

socket.on("chatHistory",(list)=>{
  const box = document.getElementById("messages");
  box.innerHTML = "";
  list.forEach(m=>{
    const d = document.createElement("div");
    d.textContent = m.nickname + ": " + m.message;
    box.appendChild(d);
  });
});

document.getElementById("sendBtn").onclick = ()=>{
  const nick = getNick();
  const msg = document.getElementById("msgInput").value;
  const room = document.getElementById("roomTitle").textContent.replace("방: ","");
  socket.emit("sendMessage",{roomId:room,nickname:nick,message:msg,type:"text"});
  document.getElementById("msgInput").value="";
};

socket.on("newMessage",(m)=>{
  const box = document.getElementById("messages");
  const d = document.createElement("div");
  d.textContent = m.nickname + ": " + m.message;
  box.appendChild(d);
});

socket.on("adminSuccess",()=>{
  document.getElementById("adminPanel").style.display="block";
});

socket.on("banList",(list)=>{
  document.getElementById("banList").innerHTML = list.join("<br>");
});
</script>
</body>
</html>
